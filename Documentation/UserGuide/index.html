<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/Product">
<head>
    <meta charset="utf-8">
    <title>User Guide Genson - Fast and easy to use Java and Scala to Json conversion library</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Genson, fast and easy to use library converting Java and Scala to Json and vice versa.">
    <meta name="keywords" content="java json, scala json, jersey json, convert json java, android json
    , json web service, json databind, json streaming">
    <meta name="author" content="Eugen Cepoi">

    <meta itemprop="name" content="Genson">
    <meta itemprop="description" content="Genson, fast and easy to use library converting Java and Scala to Json and vice versa.">

    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">

    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">

    <!-- Optional theme -->
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-theme.min.css">

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
    <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link href='/genson/css/theme.css' rel='stylesheet' type='text/css' />
    <link href='/genson/css/pygments-default.css' rel='stylesheet' type='text/css' />

    <script>

        $(function() {
          $('a[href*=#]:not([href=#])').click(function() {
            if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
              var target = $(this.hash);
              target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
              if (target.length) {
                $('html,body').animate({
                  scrollTop: target.offset().top
                }, 500);
                return false;
              }
            }
          });
        });

        
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-33280683-2', 'owlike.github.io');
          ga('send', 'pageview');
        
    </script>
</head>

<body>



<header>
    <div class="modal fade" id="shareDialog" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <iframe></iframe>
        </div>
      </div>
    </div>
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#menu-navbar-collapse-1">
                <i class="fa fa-bars menu-item"></i>
            </button>
            <a class="navbar-brand" href="/genson/">Genson</a>
        </div>
        <div class="collapse navbar-collapse" id="menu-navbar-collapse-1">
            <ul class="nav navbar-nav">
                <li><a href="/genson/GettingStarted"><i class="fa fa-compass"></i> Getting started</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-book"></i> Documentation <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a href="/genson/Documentation/UserGuide">User Guide</a></li>
                        <li><a href="/genson/Documentation/ScalaGuide">Scala Guide</a></li>
                        <li class="sep"></li>
                        <li><a href="/genson/Documentation/Extensions">Extensions</a></li>
                        <li><a href="/genson/Documentation/Configuration">Configuration</a></li>
                        <li><a href="/genson/Documentation/Benchmarks & Metrics">Benchmarks & Metrics</a></li>
                        <li><a href="/genson/Documentation/Changelog">Changelog</a></li>
                    </ul>
                </li>
                <li class="dropdown">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-code"></i> API Docs <b class="caret"></b></a>
                  <ul class="dropdown-menu">
                    <li><a href="/genson/Documentation/Javadoc">Javadoc</a></li>
                    <li><a href="/genson/Documentation/Scaladoc">Scaladoc</a></li>
                  </ul>
                </li>
                <li><a href="/genson/Community"><i class="fa fa-group"></i> Community</a></li>
                <li><a href="/genson/Faq"><i class="fa fa-question"></i> FAQ</a></li>
            </ul>
          <ul class="nav navbar-nav navbar-right">
            <li>
              <a class="share-button twitter-share-button" href="https://twitter.com/intent/tweet"
                 data-toggle="tooltip" data-placement="bottom" title="Share on Twitter">
                <i class="fa fa-twitter-square"></i>
              </a>
              <a class="share-button google-plus-share-button" href="https://plus.google.com/share"
                 data-toggle="tooltip" data-placement="bottom" title="Share on Google+">
                <i class="fa fa-google-plus-square"></i>
              </a>
              <a class="share-button linkedin-share-button" href="https://www.linkedin.com/cws/share"
                 data-toggle="tooltip" data-placement="bottom" title="Share on LinkedIn">
                <i class="fa fa-linkedin-square"></i>
              </a>
            </li>
            <script>
              var linkedInParams = {
                url: 'http://owlike.github.io/genson/',
                original_referer: document.URL,
                isFramed: false,
                lang: 'en_US',
                token: ''
              }

              var twitterParams = {
                original_referer: document.URL,
                text: '#Genson, fast and easy to use Java <> JSON library.',
                tw_p: 'tweetbutton',
                url: 'http://owlike.github.io/genson/',
                via: 'EugenCepoi'
              }

              var googlePlusParams = {
                url: 'http://owlike.github.io/genson/'
              }

              $('.share-button').tooltip({delay: { show: 500, hide: 100 }});

              share('a.twitter-share-button', 'https://twitter.com/intent/tweet?', twitterParams);
              share('a.linkedin-share-button', 'https://www.linkedin.com/cws/share?', linkedInParams);
              share('a.google-plus-share-button', 'https://plus.google.com/share?', googlePlusParams);

              function share(selector, shareUrl, params) {
                $(selector).click(function(evt) {
                  evt.preventDefault();

                  var url = shareUrl + $.map(params, function(value, key) {
                    return key+'='+encodeURIComponent(value);
                  }).join('&');

                  var t="scrollbars=yes,resizable=yes,toolbar=no,location=yes",n=550,r=420,i=screen.height,s=screen.width,o=Math.round(s/2-n/2),u=0;
                  window.open(url,null,t+",width="+n+",height="+r+",left="+o+",top="+u);
                });
              }
            </script>
          </ul>
        </div>
    </div>
</header>


<div class="jumbotron">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h1>User Guide</h1>
                <p class="catch-phrase">
                    The User Guide guide introduces Gensons main components and some features that can be enabled via configuration. After reading it you should be able to do address most of your use cases.
                </p>
            </div>
        </div>
    </div>
</div>



<div class="content">
    <div class="container">
        <div class="row">
            <div class="col-md-9" role="main">
                <h2 id="overview">Overview</h2>

<p>The main entry point in Genson library is the Genson class.
It provides methods to serialize Java objects to JSON  and deserialize JSON streams to Java objects.
Instances of Genson are immutable and thread safe, you should reuse them. In general the recommended way is to have a single instance
per configuration type. Genson provides a default constructor with no arguments that uses the default configuration.
To customize Genson have a look at the GensonBuilder.</p>

<h2 id="readwrite-json">Read/Write Json</h2>

<p>Genson by default supports main Java classes such as primitives, Lists, Maps, Dates, etc. by providing Converters for them,
if there is no such converter Genson will consider it is a Java Bean and will try to ser/de based on its Getters,
Setters, Fields and Constructors.</p>

<p>Once you have a Genson instance, you can use it to serialize/deserialize JSON strings.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kt">int</span><span class="o">[]</span> <span class="n">arrayOfInts</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[]{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">};</span>
<span class="c1">// json = [1,2,3]</span>
<span class="n">String</span> <span class="n">json</span> <span class="o">=</span> <span class="n">genson</span><span class="o">.</span><span class="na">serialize</span><span class="o">(</span><span class="n">arrayOfInts</span><span class="o">);</span>
<span class="n">genson</span><span class="o">.</span><span class="na">deserialize</span><span class="o">(</span><span class="n">json</span><span class="o">,</span> <span class="kt">int</span><span class="o">[].</span><span class="na">class</span><span class="o">);</span></code></pre></figure>

<h3 id="supported-io-classes">Supported IO classes</h3>
<p>You can also use Java OutputStream/InputStream, Writer/Reader and byte arrays instead of Strings.
In most cases you will want to use them instead of Strings for better performances.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kt">byte</span><span class="o">[]</span> <span class="n">byteArray</span> <span class="o">=</span> <span class="n">genson</span><span class="o">.</span><span class="na">serializeBytes</span><span class="o">(</span><span class="n">arrayOfInts</span><span class="o">);</span>
<span class="n">genson</span><span class="o">.</span><span class="na">serialize</span><span class="o">(</span><span class="n">arrayOfInts</span><span class="o">,</span> <span class="n">outputStream</span><span class="o">);</span>
<span class="n">genson</span><span class="o">.</span><span class="na">serialize</span><span class="o">(</span><span class="n">arrayOfInts</span><span class="o">,</span> <span class="n">writer</span><span class="o">);</span>

<span class="n">genson</span><span class="o">.</span><span class="na">deserialize</span><span class="o">(</span><span class="n">byteArray</span><span class="o">,</span> <span class="kt">int</span><span class="o">[].</span><span class="na">class</span><span class="o">);</span>
<span class="n">genson</span><span class="o">.</span><span class="na">deserialize</span><span class="o">(</span><span class="n">inputStream</span><span class="o">,</span> <span class="kt">int</span><span class="o">[].</span><span class="na">class</span><span class="o">);</span>
<span class="n">genson</span><span class="o">.</span><span class="na">deserialize</span><span class="o">(</span><span class="n">reader</span><span class="o">,</span> <span class="kt">int</span><span class="o">[].</span><span class="na">class</span><span class="o">);</span></code></pre></figure>

<h3 id="untyped-java-structures">Untyped Java structures</h3>
<p>During serialization if there is no type information available (meaning it is Object),
Genson will use the runtime type of the object to decide how to serialize it.
If it has type information then it will use it instead of the runtime type.</p>

<p>In the example below, Genson will use the runtime type of the values in the map.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">person</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;()</span> <span class="o">{{</span>
  <span class="n">put</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;Foo&quot;</span><span class="o">);</span>
  <span class="n">put</span><span class="o">(</span><span class="s">&quot;age&quot;</span><span class="o">,</span> <span class="mi">28</span><span class="o">);</span>
<span class="o">}};</span>

<span class="c1">// {&quot;age&quot;:28,&quot;name&quot;:&quot;Foo&quot;}</span>
<span class="n">String</span> <span class="n">json</span> <span class="o">=</span> <span class="n">genson</span><span class="o">.</span><span class="na">serialize</span><span class="o">(</span><span class="n">person</span><span class="o">);</span></code></pre></figure>

<p>Deserialization however is more tricky as the type must be detected based on the content of the JSON stream.
By default, if no type information is available during deserialization, Genson will provide a base mapping between JSON types and Java types.
For example, JSON object will be mapped to a Map with Strings as keys, JSON arrays to Java List, etc.
There is another mechanism allowing to <a href="#polymorphic-types">deserialize to polymorphic or unknown types</a>, but we will discuss it latter.</p>

<p>Here in both cases it will be deserialized to a map with the correct types (string and int) as they are standard Json types.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="n">genson</span><span class="o">.</span><span class="na">deserialize</span><span class="o">(</span><span class="n">json</span><span class="o">,</span> <span class="n">Map</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="n">Object</span> <span class="n">map2</span> <span class="o">=</span> <span class="n">genson</span><span class="o">.</span><span class="na">deserialize</span><span class="o">(</span><span class="n">json</span><span class="o">,</span> <span class="n">Object</span><span class="o">.</span><span class="na">class</span><span class="o">);</span></code></pre></figure>

<p><strong>Note</strong>: Sometime you might want to always use the runtime type, this can be enabled with</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">new</span> <span class="nf">GensonBuilder</span><span class="o">().</span><span class="na">useRuntimeType</span><span class="o">(</span><span class="kc">true</span><span class="o">).</span><span class="na">create</span><span class="o">()</span></code></pre></figure>

<h2 id="pojo-databinding">POJO Databinding</h2>
<p>Of course working only with Maps, Lists and primitive types is not so convenient.
Usually your goal is to map the JSON to some structure you have defined and vice versa.</p>

<p>Genson provides full support for object databinding by following standard JavaBean conventions. The basic rules for databinding are:</p>

<ul>
  <li>All public or package visibility fields, getters and setters will be used, including the inherited ones.</li>
  <li>If a getter/setter exists for a field then it will be used instead of the field (can be changed via configuration).</li>
  <li>Transient and static fields are not serialized nor used during deserialization.</li>
  <li>A default no argument constructor is required (can be configured to use constructors with arguments and support immutable types).</li>
  <li>If a field does not exist in the json stream then its field/setter will not be used (Genson can be configured to throw an exception).</li>
  <li>If a value is null then you can choose whether you want it to be serialized as null or just skipped, by default null values are serialized.</li>
  <li>Inherited annotations on methods/fields with same name are merged except JsonIgnore annotation which is a limitation for the moment.</li>
  <li>Annotations on getters and setters are not merged together, this allows to provide decoupled serialization and deserialization configurations. 
 If you want to define some annotation to be used during both serialization and deserialization, then disable method resolution,
 enable private field resolution and annotate the fields.</li>
</ul>

<p>Lets have a closer look to an example.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Person</span> <span class="n">someone</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Person</span><span class="o">(</span><span class="s">&quot;Eugen&quot;</span><span class="o">,</span> <span class="mi">28</span><span class="o">,</span> <span class="k">new</span> <span class="nf">Address</span><span class="o">(</span><span class="mi">157</span><span class="o">,</span> <span class="s">&quot;Paris&quot;</span><span class="o">));</span>

<span class="c1">// {&quot;address&quot;:{&quot;building&quot;:157,&quot;city&quot;:&quot;Paris&quot;},&quot;age&quot;:28,&quot;name&quot;:&quot;Eugen&quot;}</span>
<span class="n">String</span> <span class="n">json</span> <span class="o">=</span> <span class="n">genson</span><span class="o">.</span><span class="na">serialize</span><span class="o">(</span><span class="n">someone</span><span class="o">);</span>

<span class="c1">// deserialize it back</span>
<span class="n">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="n">genson</span><span class="o">.</span><span class="na">deserialize</span><span class="o">(</span><span class="n">json</span><span class="o">,</span> <span class="n">Person</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">age</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">Address</span> <span class="n">address</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">Person</span><span class="o">()</span> <span class="o">{}</span>

  <span class="kd">public</span> <span class="nf">Person</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">int</span> <span class="n">age</span><span class="o">,</span> <span class="n">Address</span> <span class="n">address</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">age</span> <span class="o">=</span> <span class="n">age</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">address</span> <span class="o">=</span> <span class="n">address</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="c1">// getters &amp; setters</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Address</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="n">building</span><span class="o">;</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="n">city</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">Address</span><span class="o">()</span> <span class="o">{}</span>

  <span class="kd">public</span> <span class="nf">Address</span><span class="o">(</span><span class="kt">int</span> <span class="n">building</span><span class="o">,</span> <span class="n">String</span> <span class="n">city</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">building</span> <span class="o">=</span> <span class="n">building</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">city</span> <span class="o">=</span> <span class="n">city</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p><strong>Remark</strong> Actually inner and anonymous classes serialization is supported but not deserialization, except if it is a static inner class.</p>

<p>You can also deserialize in an existing object. However this feature has some restrictions: it works only with Pojo like classes and does not handle nesting.
For example if your root object contains a list or another Pojo, then it will be overriden by the one in the json (if present, otherwise it remains unchanged).</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">genson</span><span class="o">.</span><span class="na">deserializeInto</span><span class="o">(</span><span class="n">json</span><span class="o">,</span> <span class="n">personInstance</span><span class="o">);</span></code></pre></figure>

<h2 id="filterrename-properties">Filter/Rename properties</h2>

<p>Genson provides two major ways of including/excluding and naming properties, via annotations and via configuration through GensonBuilder (not exclusive).</p>

<h3 id="via-annotations">Via annotations</h3>

<p>Excluding a property can be achieved by putting a <code>@JsonIgnore</code> annotation on the field or getter/setter. The same goes for
including a property (for example a private field that you want to be serialized) but using <code>@JsonProperty</code> annotation.
JsonProperty can also be used to define a different name for a property than the default one <code>@JsonProperty(name="newName")</code>.</p>

<h3 id="via-gensonbuilder">Via GensonBuilder</h3>

<p>The other way is using the GensonBuilder exclude/include/rename methods that support a wider range of exclusion/inclusion/naming patterns.
This feature gets handy if you can’t modify the source code of your classes or just don’t want to pollute your code with annotations.</p>

<p>For example suppose you have an attribute named password in some of your classes and want to always exclude it
or that you want to always exclude properties of some type, etc.
The code below demonstrates some of those strategies (but more are available - see the API).</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">new</span> <span class="nf">GensonBuilder</span><span class="o">()</span>
  <span class="o">.</span><span class="na">exclude</span><span class="o">(</span><span class="s">&quot;password&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">exclude</span><span class="o">(</span><span class="n">Class</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="o">.</span><span class="na">include</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="n">FromSome</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="o">.</span><span class="na">rename</span><span class="o">(</span><span class="s">&quot;type&quot;</span><span class="o">,</span> <span class="s">&quot;_type&quot;</span><span class="o">)</span>
<span class="o">.</span><span class="na">create</span><span class="o">();</span></code></pre></figure>

<h3 id="genson-wide-strategies">Genson wide strategies</h3>
<p>You can also define some strategies for property resolution that will be used for a Genson instance. You can choose whether
to use Getter&amp;Setter or Fields (or both - by default) and their visibility (public, protected, private…).</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">new</span> <span class="nf">GensonBuilder</span><span class="o">()</span>
  <span class="o">.</span><span class="na">useFields</span><span class="o">(</span><span class="kc">true</span><span class="o">,</span> <span class="n">VisibilityFilter</span><span class="o">.</span><span class="na">PRIVATE</span><span class="o">)</span>
  <span class="o">.</span><span class="na">useMethods</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
<span class="o">.</span><span class="na">create</span><span class="o">();</span></code></pre></figure>

<p>If you want to have a more general property resolution or naming strategy, you can respectively,
extend PropertyBaseResolver or implement your own PropertyNameResolver and register it.</p>

<h3 id="excluding-properties-at-runtime">Excluding properties at runtime</h3>
<p>One can also exclude a property at runtime by implementing a custom RuntimePropertyFilter and registering it via GensonBuilder.
This filter would be used every time a property is being serialized or deserialized.</p>

<h2 id="object-instantiation">Object instantiation</h2>
<p>By default Genson requires you to provide a default no argument constructor. But Genson also works with constructors that take arguments,
encouraging people to work with immutable objects.</p>

<ul>
  <li><em>Why by default doesn’t it support constructors with arguments?</em> <br />
Java reflection API does not provide access to parameter names of methods and constructors, Genson as most libs that deal with databinding uses it.</li>
</ul>

<p>To bypass this problem Genson provides two solutions, annotations and automatic detection via byte code analysis.</p>

<h3 id="annotations">Annotations</h3>

<p>Annotate each parameter of the constructor with <strong>@JsonProperty</strong>, this would tell to Genson that this is the name that must be used.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Address</span> <span class="o">{</span>
  <span class="kd">final</span> <span class="kt">int</span> <span class="n">building</span><span class="o">;</span>
  <span class="kd">final</span> <span class="n">String</span> <span class="n">city</span><span class="o">;</span>

  <span class="c1">// we could also put @JsonCreator annotation, if we had multiple</span>
  <span class="c1">// constructors and wanted Genson to use this one.</span>
  <span class="kd">public</span> <span class="nf">Address</span><span class="o">(</span><span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">&quot;building&quot;</span><span class="o">)</span> <span class="kt">int</span> <span class="n">building</span><span class="o">,</span> <span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">&quot;city&quot;</span><span class="o">)</span> <span class="n">String</span> <span class="n">city</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">building</span> <span class="o">=</span> <span class="n">building</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">city</span> <span class="o">=</span> <span class="n">city</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<h3 id="automatic-resolution">Automatic resolution</h3>

<p>You can also use constructors with arguments without using annotations.
This mechanism is disabled by default as it uses byte code parsing to extract names from code that has been compiled with debug symbols
(the default for most build systems and libs). This option does not work on Android.</p>

<p>Enable automatic name resolution for constructors and methods via the GensonBuilder.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">new</span> <span class="nf">GensonBuilder</span><span class="o">().</span><span class="na">useConstructorWithArguments</span><span class="o">(</span><span class="kc">true</span><span class="o">).</span><span class="na">create</span><span class="o">();</span></code></pre></figure>

<h3 id="factory-methods">Factory methods</h3>
<p>Genson has also support for methods that act as factories. Those methods must be static, defined inside the class you want to
deserialize (or a parent) and annotated with <code>@JsonCreator</code> annotation.
JsonCreator annotation can also be used on Constructors when you have multiple ones
and want to tell Genson which one to use.</p>

<p>In the previous example we could have a factory method that builds an Address with some default values,
that would then be overridden by Genson based on the JSON content.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Address</span> <span class="o">{</span>
  <span class="kd">final</span> <span class="kt">int</span> <span class="n">building</span><span class="o">;</span>
  <span class="kd">final</span> <span class="n">String</span> <span class="n">city</span><span class="o">;</span>

  <span class="nd">@JsonCreator</span> <span class="kd">public</span> <span class="kd">static</span> <span class="n">Address</span> <span class="nf">default</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">Address</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="s">&quot;UNKNOWN&quot;</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="nf">Address</span><span class="o">(</span><span class="kt">int</span> <span class="n">building</span><span class="o">,</span> <span class="n">String</span> <span class="n">city</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">building</span> <span class="o">=</span> <span class="n">building</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">city</span> <span class="o">=</span> <span class="n">city</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<h2 id="exceptions">Exceptions</h2>

<p>Since version 0.99 there are no checked exceptions anymore.
The main reason is to avoid ugly boilerplate code for people who use Genson. Of course even if Genson makes use of unchecked exceptions you
can still catch them if you want to handle them. Genson can throw two kind of exceptions:</p>

<ul>
  <li><strong>JsonStreamException</strong>, thrown by the streaming API when parsing for example invalid JSON.</li>
  <li><strong>JsonBindingException</strong>, everywhere else, especially if something goes wrong at the databinding level, ex: can not instantiate some type.</li>
</ul>

<h2 id="generic-types">Generic types</h2>

<p>Due to type erasure, in Java, we can not do things like List&lt;Address&gt;.class. Meaning that we can’t tell to Genson to deserialize to a List of Addresses but only to a list of unknown objects.
Those unknown objects being deserialized as Maps. The solution is to use what is called TypeToken, described in <a href="http://gafter.blogspot.fr/2006/12/super-type-tokens.html">this blog</a>.
Gensons implementation of TypeToken is named GenericType. Why not TypeToken?
Because this name is used in Guava library so choosing another name allows to avoid confusion and mistakes.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">listOfInt</span> <span class="o">=</span> <span class="n">genson</span><span class="o">.</span><span class="na">deserialize</span><span class="o">(</span><span class="s">&quot;[1, 2]&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">GenericType</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;(){});</span></code></pre></figure>

<p>Genson has full support of Javas generics, allowing you to hava quite complex structures and still be able to ser/de it.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// enable constructor parameter names resolution through byte code analysis</span>
<span class="n">Genson</span> <span class="n">genson</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">GensonBuilder</span><span class="o">().</span><span class="na">useConstructorWithArguments</span><span class="o">(</span><span class="kc">true</span><span class="o">).</span><span class="na">create</span><span class="o">();</span>

<span class="n">AddressGroup</span> <span class="n">addressGroup</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">AddressGroup</span><span class="o">(</span><span class="k">new</span> <span class="n">Container</span><span class="o">&lt;</span><span class="n">EuropeanAddress</span><span class="o">&gt;(</span>
    <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="k">new</span> <span class="nf">EuropeanAddress</span><span class="o">(</span><span class="s">&quot;Champs Elysees&quot;</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="s">&quot;Paris&quot;</span><span class="o">)))</span>
  <span class="o">);</span>

<span class="c1">// {&quot;addressGroup&quot;:{&quot;values&quot;:[{&quot;building&quot;:1,&quot;city&quot;:&quot;Paris&quot;,&quot;street&quot;:&quot;Champs Elysees&quot;}]}}</span>
<span class="n">String</span> <span class="n">json</span> <span class="o">=</span> <span class="n">genson</span><span class="o">.</span><span class="na">serialize</span><span class="o">(</span><span class="n">addressGroup</span><span class="o">);</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EuropeanAddress</span> <span class="kd">extends</span> <span class="n">Address</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">street</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">EuropeanAddress</span><span class="o">(</span><span class="n">String</span> <span class="n">street</span><span class="o">,</span> <span class="kt">int</span> <span class="n">building</span><span class="o">,</span> <span class="n">String</span> <span class="n">city</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">(</span><span class="n">building</span><span class="o">,</span> <span class="n">city</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">street</span> <span class="o">=</span> <span class="n">street</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AddressGroup</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">final</span> <span class="n">Container</span><span class="o">&lt;</span><span class="n">EuropeanAddress</span><span class="o">&gt;</span> <span class="n">addressGroup</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">AddressGroup</span><span class="o">(</span><span class="n">Container</span><span class="o">&lt;</span><span class="n">EuropeanAddress</span><span class="o">&gt;</span> <span class="n">addressGroup</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">addressGroup</span> <span class="o">=</span> <span class="n">addressGroup</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Container</span><span class="o">&lt;</span><span class="n">E</span> <span class="kd">extends</span> <span class="n">Address</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">values</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">Container</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">values</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">values</span> <span class="o">=</span> <span class="n">values</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p><strong>Remark</strong> that if in AddressGroup we were using Address type instead of the concrete type, the serialized json wouldn’t contain the street property.
Indeed it would have been ser/de using Address type, using the runtime type can be enable via <code>new GensonBuilder().useRuntimeType(true)</code>.</p>

<h2 id="polymorphic-types">Polymorphic types</h2>

<p>Another nice feature of Genson is its ability to deserialize an object serialized with Genson back to its concrete type.
Lets now enable runtime type resolution and serialize a Container of EuropeanAddress and then deserialize it back.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// lets also enable runtime type usage</span>
<span class="n">Genson</span> <span class="n">genson</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">GensonBuilder</span><span class="o">().</span><span class="na">useRuntimeType</span><span class="o">(</span><span class="kc">true</span><span class="o">).</span><span class="na">create</span><span class="o">();</span>

<span class="n">Container</span><span class="o">&lt;</span><span class="n">Address</span><span class="o">&gt;</span> <span class="n">addressContainer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Container</span><span class="o">&lt;</span><span class="n">Address</span><span class="o">&gt;(</span>
    <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="k">new</span> <span class="nf">EuropeanAddress</span><span class="o">(</span><span class="s">&quot;Champs Elysees&quot;</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="s">&quot;Paris&quot;</span><span class="o">)))</span>
  <span class="o">);</span>

<span class="c1">// As we enabled runtime type resolution the street property will be serialized</span>
<span class="c1">// {&quot;values&quot;:[{&quot;building&quot;:1,&quot;city&quot;:&quot;Paris&quot;,&quot;street&quot;:&quot;Champs Elysees&quot;}]}</span>
<span class="n">String</span> <span class="n">json</span> <span class="o">=</span> <span class="n">genson</span><span class="o">.</span><span class="na">serialize</span><span class="o">(</span><span class="n">addressContainer</span><span class="o">);</span>

<span class="c1">// however when we deserialize Genson does not have enough type information.</span>
<span class="c1">// It will expand the content of the array to Address and not EuropeanAddress</span>
<span class="n">Container</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Address</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">genson</span><span class="o">.</span><span class="na">deserialize</span><span class="o">(</span><span class="n">json</span><span class="o">,</span> <span class="n">Container</span><span class="o">.</span><span class="na">class</span><span class="o">);</span></code></pre></figure>

<p>Of course in the previous example we could have deserialized to a <code>new GenericType&lt;Container&lt;EuropeanAddress&gt;&gt;()</code>,
but if there were multiple implementations of Address or just mixed EuropeanAddress and Address instances, you won’t get the correct result.</p>

<p>The solution to this problem is to store in the serialized json the information about the concrete type.
In Genson it is implemented via a metadata mechanism that will serialize class name + package during serialization and use
it when deserializing back.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// lets enable class metadata ser/de, allowing to deserialize back polymorphic types</span>
<span class="n">Genson</span> <span class="n">genson</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">GensonBuilder</span><span class="o">()</span>
      <span class="o">.</span><span class="na">useClassMetadata</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
      <span class="o">.</span><span class="na">useRuntimeType</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
    <span class="o">.</span><span class="na">create</span><span class="o">();</span>

<span class="c1">// {&quot;values&quot;:[{&quot;@class&quot;:&quot;my.package.EuropeanAddress&quot;,&quot;building&quot;:1,&quot;city&quot;:&quot;Paris&quot;,&quot;street&quot;:&quot;Champs Elysees&quot;}]}</span>
<span class="n">AddressGroup</span> <span class="n">result</span> <span class="o">=</span> <span class="n">genson</span><span class="o">.</span><span class="na">serialize</span><span class="o">(</span><span class="n">addressContainer</span><span class="o">);</span></code></pre></figure>

<p>Genson provides an alias mechanism for classes, allowing to use the alias instead of the full class name.
It is a good practice to do so as it gives you the ability to rename your class or package without any impact
on the json (especially useful if you store json in a persistent storage) and it is also safer from a security point of view.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// addAlias creates an alias between a logic name and a full class name, this also enables class metadata mechanism</span>
<span class="n">Genson</span> <span class="n">genson</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">GensonBuilder</span><span class="o">()</span>
      <span class="o">.</span><span class="na">addAlias</span><span class="o">(</span><span class="s">&quot;europeanAddress&quot;</span><span class="o">,</span> <span class="n">EuropeanAddress</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
      <span class="o">.</span><span class="na">useRuntimeType</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
    <span class="o">.</span><span class="na">create</span><span class="o">();</span>

<span class="c1">// {&quot;values&quot;:[{&quot;@class&quot;:&quot;europeanAddress&quot;,&quot;building&quot;:1,&quot;city&quot;:&quot;Paris&quot;,&quot;street&quot;:&quot;Champs Elysees&quot;}]}</span>
<span class="n">genson</span><span class="o">.</span><span class="na">serialize</span><span class="o">(</span><span class="n">addressContainer</span><span class="o">);</span></code></pre></figure>

<p><strong>Remarks</strong></p>

<ul>
  <li>
    <p>Class metadata and the overall metadata mechanism is available only for object types and not for arrays or litteral values.
 Metadata must always be the first name/value pairs in json objects.</p>
  </li>
  <li>
    <p>Genson does not serialize, nor use class metadata for standard types (lists, primitives, etc).</p>
  </li>
  <li>
    <p>If you define a custom Converter and do not want Genson to use class metadata for types supported by your Converter
 use @HandleClassMetadata annotation.</p>
  </li>
</ul>

<h2 id="streaming-api">Streaming API</h2>

<p>Genson has lower memory consumption than DOM based parsers, because Genson does not need to store the complete JSON document in memory.
This low memory footprint is being achieved via the Streaming API. As your objects are being serialized, the JSON is directly written to
the output. Same during deserialization, as the JSON arrives in the stream, Genson will parse it and map to your objects.</p>

<p>This is a valuable feature in real life applications, like web applications or web services, where a client is writing/reading data through the network.
The network is the most common bottleneck, paralleling the work while data is being transferred increases the throughput.</p>

<p>Genson databinding uses the streaming API, but you can also directly use it without the databinding layer in case
where you really need something extremely fast, <strong>in most cases you don’t as it is already very efficient</strong>.</p>

<p>The main classes of the Streaming API are ObjectWriter and ObjectReader, they are internally used by Genson to write/read JSON data.
When implementing your own Converters to achieve custom serialization/deserialization, you will use this low level API.
But in some cases you might also want to use them directly without any databinding. You can build them through Genson class.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java">  <span class="n">ObjectWriter</span> <span class="n">writer</span> <span class="o">=</span> <span class="n">genson</span><span class="o">.</span><span class="na">createWriter</span><span class="o">(</span><span class="n">outputStream</span><span class="o">);</span>
  <span class="n">ObjectReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="n">genson</span><span class="o">.</span><span class="na">createReader</span><span class="o">(</span><span class="n">inputStream</span><span class="o">);</span></code></pre></figure>

<p>For example writing some object, containing an array and some basic properties can be easily done.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// {&quot;name&quot;:&quot;Foo Bar&quot;,&quot;age&quot;:45,&quot;childrenAges&quot;:[1,2,3]}</span>
<span class="n">writer</span><span class="o">.</span><span class="na">beginObject</span><span class="o">()</span>
    <span class="o">.</span><span class="na">writeString</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;Foo Bar&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">writeNumber</span><span class="o">(</span><span class="s">&quot;age&quot;</span><span class="o">,</span> <span class="mi">45</span><span class="o">)</span>
    <span class="o">.</span><span class="na">writeName</span><span class="o">(</span><span class="s">&quot;childrenAges&quot;</span><span class="o">).</span><span class="na">beginArray</span><span class="o">()</span>
      <span class="o">.</span><span class="na">writeValue</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
      <span class="o">.</span><span class="na">writeValue</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>
      <span class="o">.</span><span class="na">writeValue</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
    <span class="o">.</span><span class="na">endArray</span><span class="o">()</span>
  <span class="o">.</span><span class="na">endObject</span><span class="o">();</span>

<span class="cm">/* when using directly the streaming api outside the databinding you are free to flush the data when</span>
<span class="cm">you want allowing to reduce the memory foot print, when closing the writer everything is flushed. */</span>
<span class="n">writer</span><span class="o">.</span><span class="na">close</span><span class="o">();</span></code></pre></figure>

<p>Reading back the previous structure is a bit more of code, mainly because of Java verbosity. Of course you can also use Genson
to deserialize your JSON to a map and then just extract your properties from there. If you use this API in a Converter,
then you might want to <a href="/Documentation/Extensions/#using-jsr-353-types-with-genson">use JSR 353 types with Genson</a> for intermediary
representation and then map it to your structure. This would be OK, as it will be applied only to the part handled by your Converter, all the rest
would still use directly the Streaming API.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">childrenAges</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

<span class="n">reader</span><span class="o">.</span><span class="na">beginObject</span><span class="o">();</span>
<span class="k">while</span> <span class="o">(</span><span class="n">reader</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
  <span class="cm">/* return an enum corresponding to the type of the value being read (OBJECT, ARRAY, NULL...),</span>
<span class="cm">  allows to implement generic parsing based on the json content */</span>
  <span class="n">ValueType</span> <span class="n">valueType</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>

  <span class="k">if</span> <span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">reader</span><span class="o">.</span><span class="na">name</span><span class="o">()))</span> <span class="o">{</span>
      <span class="n">name</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="na">valueAsString</span><span class="o">();</span>
  <span class="o">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="s">&quot;age&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">reader</span><span class="o">.</span><span class="na">name</span><span class="o">()))</span> <span class="o">{</span>
      <span class="n">age</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="na">valueAsInt</span><span class="o">();</span>
  <span class="o">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="s">&quot;childrenAges&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">reader</span><span class="o">.</span><span class="na">name</span><span class="o">()))</span> <span class="o">{</span>
      <span class="n">childrenAges</span> <span class="o">=</span> <span class="n">readAnArray</span><span class="o">(</span><span class="n">reader</span><span class="o">);</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="cm">/* skip this value, and recursively all its children if it is an object or an array,</span>
<span class="cm">    and continue the parsing */</span>
    <span class="n">reader</span><span class="o">.</span><span class="na">skipValue</span><span class="o">();</span>
    <span class="c1">// or throw an error and stop</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalStateException</span><span class="o">(</span><span class="s">&quot;Unknown property &quot;</span> <span class="o">+</span> <span class="n">reader</span><span class="o">.</span><span class="na">name</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span>
<span class="n">reader</span><span class="o">.</span><span class="na">endObject</span><span class="o">();</span>

<span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">readAnArray</span><span class="o">(</span><span class="n">ObjectReader</span> <span class="n">reader</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">array</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;();</span>
  <span class="n">reader</span><span class="o">.</span><span class="na">beginArray</span><span class="o">();</span>
  <span class="k">while</span><span class="o">(</span><span class="n">reader</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">reader</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
      <span class="n">array</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">reader</span><span class="o">.</span><span class="na">valueAsInt</span><span class="o">());</span>
  <span class="o">}</span>
  <span class="n">reader</span><span class="o">.</span><span class="na">endArray</span><span class="o">();</span>
  <span class="k">return</span> <span class="n">array</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure>

<h2 id="custom-serde">Custom Ser/De</h2>

<p>In some cases Genson may not serialize/deserialize a class the way you would like.
First you should try to have a look at the different options available to you, such as Genson configuration via the GensonBuilder or annotations.</p>

<h3 id="custom-converter">Custom Converter</h3>

<p>If nothing seems to help solve your problem, then you might want to implement your-self the way a specific type is being ser/de.
This is achieved through implementing a custom Converter. A Converter is mainly an implementation of a Serializer and Deserializer for a specific type.
If you don’t need to provide a logic for serialization <strong>and</strong> deserialization, then you can implement only one of them.</p>

<p>Lets move the previous code in a datastructure and handle it in our Converter.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Genson</span> <span class="n">genson</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">GensonBuilder</span><span class="o">().</span><span class="na">withConverters</span><span class="o">(</span><span class="k">new</span> <span class="nf">PersonConverter</span><span class="o">()).</span><span class="na">create</span><span class="o">();</span>

<span class="n">genson</span><span class="o">.</span><span class="na">deserialize</span><span class="o">(</span><span class="s">&quot;{\&quot;name\&quot;:\&quot;Foo Bar\&quot;,\&quot;age\&quot;:45,\&quot;childrenAges\&quot;:[1,2,3]}&quot;</span><span class="o">,</span> <span class="n">Person</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PersonConverter</span> <span class="kd">implements</span> <span class="n">Converter</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">GenericType</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="n">typeOfChildrenAges</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GenericType</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;()</span> <span class="o">{};</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">serialize</span><span class="o">(</span><span class="n">Person</span> <span class="n">person</span><span class="o">,</span> <span class="n">ObjectWriter</span> <span class="n">writer</span><span class="o">,</span> <span class="n">Context</span> <span class="n">ctx</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">writer</span><span class="o">.</span><span class="na">beginObject</span><span class="o">();</span>
    <span class="n">writer</span><span class="o">.</span><span class="na">writeString</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="n">person</span><span class="o">.</span><span class="na">getName</span><span class="o">())</span>
          <span class="o">.</span><span class="na">writeNumber</span><span class="o">(</span><span class="s">&quot;age&quot;</span><span class="o">,</span> <span class="n">person</span><span class="o">.</span><span class="na">getAge</span><span class="o">())</span>
          <span class="o">.</span><span class="na">writeName</span><span class="o">(</span><span class="s">&quot;childrenAges&quot;</span><span class="o">);</span>

    <span class="cm">/* Delegate the serialization of a list of integer to Genson, you can pass null here.</span>
<span class="cm">    Note that this will involve a lookup for the matching converter. */</span>
    <span class="n">ctx</span><span class="o">.</span><span class="na">genson</span><span class="o">.</span><span class="na">serialize</span><span class="o">(</span><span class="n">person</span><span class="o">.</span><span class="na">getChildrenAges</span><span class="o">(),</span> <span class="n">writer</span><span class="o">,</span> <span class="n">ctx</span><span class="o">);</span>

    <span class="n">writer</span><span class="o">.</span><span class="na">endObject</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="cm">/* You don&#39;t have to worry for the object being null here, if it is null Genson will</span>
<span class="cm">  handle it for you. */</span>
  <span class="kd">public</span> <span class="n">Person</span> <span class="nf">deserialize</span><span class="o">(</span><span class="n">ObjectReader</span> <span class="n">reader</span><span class="o">,</span> <span class="n">Context</span> <span class="n">ctx</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Person</span><span class="o">();</span>
    <span class="n">reader</span><span class="o">.</span><span class="na">beginObject</span><span class="o">();</span>

    <span class="k">while</span> <span class="o">(</span><span class="n">reader</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">reader</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
      <span class="k">if</span> <span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">reader</span><span class="o">.</span><span class="na">name</span><span class="o">()))</span> <span class="o">{</span>
          <span class="n">person</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">reader</span><span class="o">.</span><span class="na">valueAsString</span><span class="o">());</span>
      <span class="o">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="s">&quot;age&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">reader</span><span class="o">.</span><span class="na">name</span><span class="o">()))</span> <span class="o">{</span>
          <span class="n">person</span><span class="o">.</span><span class="na">setAge</span><span class="o">(</span><span class="n">reader</span><span class="o">.</span><span class="na">valueAsInt</span><span class="o">());</span>
      <span class="o">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="s">&quot;childrenAges&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">reader</span><span class="o">.</span><span class="na">name</span><span class="o">()))</span> <span class="o">{</span>
          <span class="c1">// here we replace the boilerplate code by delegating to genson</span>
          <span class="n">person</span><span class="o">.</span><span class="na">setChildrenAges</span><span class="o">(</span><span class="n">ctx</span><span class="o">.</span><span class="na">genson</span><span class="o">.</span><span class="na">deserialize</span><span class="o">(</span><span class="n">typeOfChildrenAges</span><span class="o">,</span> <span class="n">reader</span><span class="o">,</span> <span class="n">ctx</span><span class="o">));</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
          <span class="n">reader</span><span class="o">.</span><span class="na">skipValue</span><span class="o">();</span>
      <span class="o">}</span>
    <span class="o">}</span>

    <span class="n">reader</span><span class="o">.</span><span class="na">endObject</span><span class="o">();</span>
    <span class="k">return</span> <span class="n">person</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">age</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">childrenAges</span><span class="o">;</span>

  <span class="c1">// constructors &amp; setters &amp; getters</span>
<span class="o">}</span></code></pre></figure>

<p>Like for the property childrenAges, in practice when implementing your own Converter, you will probably have to deal with more complex structures.
Delegating to Genson the ser/de of complex types that you don’t need to handle can greatly reduce the amount of code.</p>

<p>You can also create a custom Serializer and Deserializer if you want to handle only serialization or deserialization.</p>

<h3 id="converter-factory">Converter Factory</h3>

<p>Converters are registered for specific types. The one they have in their signature and additional ones that you can specify when registering the Converter.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">new</span> <span class="nf">GensonBuilder</span><span class="o">().</span><span class="na">withConverter</span><span class="o">(</span><span class="n">personConverter</span><span class="o">,</span> <span class="n">Person</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">create</span><span class="o">();</span></code></pre></figure>

<p>But in some cases you may want to be able to register a Converter for a complete hierarchy of types, ie. for Person and all its subclasses.
This is one of the reasons Converter Factory has been introduced in Genson. The main role of a Factory is to return a Converter instance for a given type or null if the
Factory does not handle this type.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="k">new</span> <span class="nf">GensonBuilder</span><span class="o">().</span><span class="na">withConverterFactory</span><span class="o">(</span><span class="k">new</span> <span class="nf">PersonConverterFactory</span><span class="o">()).</span><span class="na">create</span><span class="o">();</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PersonConverterFactory</span> <span class="kd">implements</span> <span class="n">Factory</span><span class="o">&lt;</span><span class="n">Converter</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;&gt;</span> <span class="o">{</span>

  <span class="cm">/*Create method will be only called when type is Person or a subclass, you can safely assume</span>
<span class="cm">  the upper bound of type is Person. The obtained Converter will be cached for further reuse.*/</span>
  <span class="kd">public</span> <span class="n">Converter</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="nf">create</span><span class="o">(</span><span class="n">Type</span> <span class="n">type</span><span class="o">,</span> <span class="n">Genson</span> <span class="n">genson</span><span class="o">)</span> <span class="o">{</span>

    <span class="cm">/*TypeUtil class provides methods to deal with java.lang.reflect.Type similar to what you can</span>
<span class="cm">     find in TypeToken class of Guava. At the moment this class is more dedicated to internal</span>
<span class="cm">     use, that&#39;s why the API lacks of documentation and is a bit rudimentary.*/</span>
    <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">rawClass</span> <span class="o">=</span> <span class="n">TypeUtil</span><span class="o">.</span><span class="na">getRawClass</span><span class="o">(</span><span class="n">type</span><span class="o">);</span>

    <span class="cm">/*Instead of calling serialize method of the genson object in the Converter; involving a</span>
<span class="cm">    lookup for the right Converter; you can do it only once in the Factory and then provide it</span>
<span class="cm">    to your converter.*/</span>
    <span class="n">Type</span> <span class="n">typeOfListOfInt</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GenericType</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;()</span> <span class="o">{}.</span><span class="na">getType</span><span class="o">();</span>
    <span class="n">Converter</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="n">listOfIntConverter</span> <span class="o">=</span> <span class="n">genson</span><span class="o">.</span><span class="na">provideConverter</span><span class="o">(</span><span class="n">typeOfListOfInt</span><span class="o">);</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nf">PersonConverter</span><span class="o">(</span><span class="n">listOfIntConverter</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<h3 id="contextual-converter">Contextual Converter</h3>

<p>Another nice feature in Genson is the support of Contextual Converters and Factories.
The contextual converter is used through <code>@JsonConverter</code> annotation,
that you put on object properties (fields, methods, constructor arguments).
This will tell Genson to use this specific Converter for that property instead of any other.</p>

<p>You can also implement a <code>ContextualFactory</code> to create Converters based on the property</p>

<ul>
  <li>type</li>
  <li>name</li>
  <li>annotations</li>
  <li>the class in which the property is declared.</li>
</ul>

<p>This can become really handy if you want to apply some custom Converters based on such criteria.
The <code>@JsonConverter</code> and <code>@JsonDateFormat</code> support have been implemented using Contextual Factories.</p>

<p>For example if you want to use some specific converter only when some custom annotation is present on the property:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyContextualFactory</span> <span class="kd">implements</span> <span class="n">ContextualFactory</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Converter</span> <span class="nf">create</span><span class="o">(</span><span class="n">BeanProperty</span> <span class="n">property</span><span class="o">,</span> <span class="n">Genson</span> <span class="n">genson</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">MyCustomAnnotation</span> <span class="n">ann</span> <span class="o">=</span> <span class="n">property</span><span class="o">.</span><span class="na">getAnnotation</span><span class="o">(</span><span class="n">MyCustomAnnotation</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">ann</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">myCustomConverter</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="n">Genson</span> <span class="n">genson</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">GensonBuilder</span><span class="o">().</span><span class="na">withContextualFactory</span><span class="o">(</span><span class="k">new</span> <span class="nf">MyContextualFactory</span><span class="o">()).</span><span class="na">create</span><span class="o">();</span></code></pre></figure>

<p>A couple of other things &amp; components can be customized, but they are a even more advanced usage and require some knowledge of how Genson works,
thus they are not documented here. If you encounter any problems or don’t know how to achieve something, don’t hesitate to post a message on the mailling list.
You can also get help there on how to extend more “internal” parts of Genson.</p>

            </div>
            <div class="col-md-3">
                <div class="content-nav hidden-print" data-spy="affix" data-offset-top="240" role="complementary">
                    <ul class="nav nav-tabs nav-stacked">
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
$(function() {
    var menuContent = $('.content-nav ul')
    $('h2').each(function(idx, elem) {
      var $elem = $(elem)

      if ($elem.index() > 0) $elem.before('<hr />')

      menuContent.append('<li><a href="#' + elem.id + '">' + elem.innerHTML + '</a></li>')
    })


    $('body').scrollspy({ target: '.content-nav' })
})
</script>



<footer>
  <div class="text-center">
    <div class="row">
      <a href="https://github.com/owlike/genson"><i class="fa fa-github"></i></a>
    </div>
    <div class="row">
      Copyright &copy; 2011-2014, Eugen Cepoi
    </div>
  </div>
</footer>
</body>
</html>
